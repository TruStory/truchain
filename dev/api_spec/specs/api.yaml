meta:
  name: TruChain API
configuration:
  scheme: http
  host: localhost
  port: 1337
  base_path: /
spec_dependencies:
  - ./specs/register_key.yaml
  - ./specs/submit_story.yaml
specs:
    - name: Query stories by categoryID
      before_test:
        run_type: inline
        inline:
          function: !js/asyncFunction >
            async function() {
              await this.runSpec('Register key');
              await this.runSpec('Submit story');
            }
      request:
        path: /graphql
        method: post
        headers:
          - name: content-type
            value: application/json
        payload:
          body:
            type: json
            content:
              query: "query { stories(categoryID: $categoryID) { body } }"
              variables:
                categoryID: "1"
      response:
        status_code: 200
        json_data:
          - path: $.data.stories.0.body
            value: A new story!